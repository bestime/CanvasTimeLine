/**  
 * CanvasTimeLine.iife.min.js
 * @QQ 1174295440
 * @update 2023-03-06 10:56:01
 */
var CanvasTimeLine=function(){"use strict";function s(t){return null===(e=t)||e===undefined?"":String(t);var e}function n(t,e,i,n){return(t=s(t)).length>(e>>=0)?t:(e-=t.length,i.length<e&&(i+=function(t,e){var i="";if((t=s(t)).length*e<1<<28)for(;1==(1&e)&&(i+=t),0!=(e>>>=1);)t+=t;return i}(i,e/i.length)),-1===n?i.slice(0,e)+t:t+i.slice(0,e))}function c(t,e,i){return n(t,e,i,-1)}document.getElementsByTagName("head")[0];var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,i=t||e||Function("return this")(),t=i.Symbol,e=Object.prototype,a=e.hasOwnProperty,h=e.toString,u=t?t.toStringTag:undefined;var _=Object.prototype.toString;var l=t?t.toStringTag:undefined;function o(t){if(null==t)return t===undefined?"[object Undefined]":"[object Null]";if(l&&l in Object(t)){var e=t,i=a.call(e,u),n=e[u];try{e[u]=undefined;var s=!0}catch(r){}var o=h.call(e);return s&&(i?e[u]=n:delete e[u]),o}return _.call(t)}var r=/\s/;var m=/^\s+/;function f(t){return t&&t.slice(0,function(t){for(var e=t.length;e--&&r.test(t.charAt(e)););return e}(t)+1).replace(m,"")}function g(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var d=/^[-+]0x[0-9a-f]+$/i,v=/^0b[01]+$/i,p=/^0o[0-7]+$/i,x=parseInt;function b(t){if("number"==typeof t)return t;if("symbol"==typeof(i=t)||null!=(e=i)&&"object"==typeof e&&"[object Symbol]"==o(i))return NaN;var e;if("string"!=typeof(t=g(t)?g(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=f(t);var i=v.test(t);return i||p.test(t)?x(t.slice(2),i?2:8):d.test(t)?NaN:+t}var y=function(){return i.Date.now()},T="Expected a function",w=Math.max,M=Math.min;function E(n,i,t){var s,o,r,a,h,c,u=0,_=!1,l=!1,e=!0;if("function"!=typeof n)throw new TypeError(T);function m(t){var e=s,i=o;return s=o=undefined,u=t,a=n.apply(i,e)}function f(t){var e=t-c;return c===undefined||i<=e||e<0||l&&r<=t-u}function d(){var t,e=y();if(f(e))return v(e);h=setTimeout(d,(t=i-((e=e)-c),l?M(t,r-(e-u)):t))}function v(t){return h=undefined,e&&s?m(t):(s=o=undefined,a)}function p(){var t=y(),e=f(t);if(s=arguments,o=this,c=t,e){if(h===undefined)return u=t=c,h=setTimeout(d,i),_?m(t):a;if(l)return clearTimeout(h),h=setTimeout(d,i),m(c)}return h===undefined&&(h=setTimeout(d,i)),a}return i=b(i)||0,g(t)&&(_=!!t.leading,l="maxWait"in t,r=l?w(b(t.maxWait)||0,i):r,e="trailing"in t?!!t.trailing:e),p.cancel=function(){h!==undefined&&clearTimeout(h),u=0,s=c=o=h=undefined},p.flush=function(){return h===undefined?a:v(y())},p}var S="Expected a function";function C(t){return c(t.year,4,"0")+"-"+c(t.month,2,"0")+"-"+c(t.day,2,"0")+" "+c(t.hour,2,"0")+":"+c(t.minute,2,"0")+":"+c(t.second,2,"0")}function D(t){t=new Date(t);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),milliSecond:t.getMilliseconds()}}function k(t){var e=0,i="second",n="minute",s="分";switch(t){case"second":e=1e3,i="second",n="minute",s="分";break;case"minute":e=6e4,i="minute",n="hour",s="时"}return{step:e,scale:i,parent:n,scaleName:s}}return function(){function t(t,e){var i,n,s,o,r,a,h=this;function c(){clearInterval(a)}this._canvas=void 0,this._range=[0,0],this._options=void 0,this._preValue=0,this._datetime=(new Date).getTime(),this._times=[],this._timerEmit=void 0,this._ctx=void 0,this._pressX=0,this._isMouseDown=!1,this._pressTime=0,this._step=k("second"),this._obsEle=void 0,this._mouseX=void 0,this._onMouseup=this._onMouseup.bind(this),this._onMouesmove=function(t,e,i){var n=!0,s=!0;if("function"!=typeof t)throw new TypeError(S);return g(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),E(t,e,{leading:n,maxWait:e,trailing:s})}(this._onMouesmove.bind(this),17),this._canvas=t,this._ctx=t.getContext("2d"),this._options=Object.assign({style:{backgroundColor:"black",scaleEnableColor:"#888888",scaleDisabledColor:"#333",mouseInfoColor:"#d7d7d7",centerColor:"#ffcc00",font:"12px serif"},precision:"minute"},e),this._step=k(this._options.precision),this.updateSize(),this.setStyle(this._options.style),this._initDrag(),this._obsEle=(i=this._canvas,n=function(){h.updateSize()},t=(t=100)||500,r=[0,0,!(o=[0,0,!(s="width")])],a=setInterval(function(){i.isConnected?(o[0]=i.offsetWidth,r[0]=i.offsetHeight,o[2]=o[0]!==o[1],r[2]=r[0]!==r[1],o[2]&&(o[1]=o[0],"width"===s)&&n(i),r[2]&&(r[1]=r[0],"height"===s)&&n(i),s||(o[2]||r[2])&&n(i)):c()},t),c)}var e=t.prototype;return e.draw=function(){this._times=[];var t=this._canvas.offsetWidth,e=(this._ctx.clearRect(0,0,t,60),Math.ceil(t/2));this._drawScaleInfo(t,e),this._drawCenterLine(e),this._drawMouseInfo()},e._initDrag=function(){var i=this;this._canvas.onmousedown=function(t){i._isMouseDown=!0,i._pressTime=i._datetime,i._pressX=t.clientX,document.removeEventListener("mouseup",i._onMouseup),document.removeEventListener("mousemove",i._onMouesmove),document.addEventListener("mouseup",i._onMouseup),document.addEventListener("mousemove",i._onMouesmove)},this._canvas.onmousemove=function(t){var e=i._canvas.getBoundingClientRect();i._mouseX=t.clientX-e.left,i.draw()},this._canvas.onmouseout=this._canvas.onmouseleave=function(){i._mouseX=undefined,i.draw()},this._canvas.ondblclick=function(t){var e=i._canvas.getBoundingClientRect(),t=t.clientX-e.left;i.setDateTime(i._times[t])}},e._emitTime=function(){var e=this;clearTimeout(this._timerEmit),this._options.onChange&&(this._timerEmit=setTimeout(function(){var t;e._preValue!==e._datetime&&(e._preValue=e._datetime,t=C(D(e._datetime)),e._options.onChange(t))},200))},e._drawMouseInfo=function(){var t,e,i,n;"number"==typeof this._mouseX&&this._times[this._mouseX]&&(t=this._mouseX,e=this._options.style.mouseInfoColor,this._ctx.beginPath(),this._ctx.strokeStyle=e,this._ctx.lineWidth=1,this._ctx.moveTo(t-.5,0),this._ctx.lineTo(t-.5,30),this._ctx.stroke(),this._ctx.closePath(),i=this._canvas.offsetWidth,n=t-50,n=Math.min(n,i-115),n=Math.max(n,2),this._ctx.beginPath(),this._ctx.fillStyle=e,this._ctx.font=this._options.style.font,this._ctx.fillText(this._times[t],n,42),this._ctx.closePath())},e._onMouesmove=function(t){t=t.clientX-this._pressX;this._datetime=this._getLimitTime(this._pressTime-t*this._step.step),this.draw()},e._onMouseup=function(){this._isMouseDown=!1,document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("mousemove",this._onMouesmove),this._emitTime()},e._drawScaleInfo=function(t,e){var i=this._datetime-e*this._step.step;this._ctx.lineWidth=1;for(var n=0;n<t;n++){this._ctx.beginPath();var s,o,r,a=i+n*this._step.step,h=D(a);this._times.push(C(h)),h[this._step.scale]%10==0&&(r=(s=0===h[this._step.scale])?14:8,a=this._checkEnableTime(a)?this._options.style.scaleEnableColor:this._options.style.scaleDisabledColor,this._ctx.strokeStyle=a,this._ctx.moveTo(o=n-.5,0),this._ctx.lineTo(o,r),this._ctx.stroke(),this._ctx.closePath(),s)&&(this._ctx.beginPath(),this._ctx.fillStyle=a,this._ctx.font=this._options.style.font,o=""+c(h[this._step.parent],2,"0")+this._step.scaleName,r=this._ctx.measureText(o).width,this._ctx.fillText(o,n-Math.floor(r/2),26),this._ctx.closePath())}},e._drawCenterLine=function(t){this._checkEnableTime(this._datetime)&&(this._ctx.beginPath(),this._ctx.strokeStyle=this._options.style.centerColor,this._ctx.lineWidth=2,this._ctx.moveTo(t,0),this._ctx.lineTo(t,43),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.fillStyle=this._options.style.centerColor,this._ctx.font=this._options.style.font,this._ctx.fillText(this._times[t],t-50,55),this._ctx.closePath())},e._checkEnableTime=function(t){return!(0!==this._range[0]&&t<this._range[0]||0!==this._range[1]&&t>this._range[1])},e.setDateTime=function(t){this._isMouseDown=!1,this._mouseX=undefined,this._datetime=this._getLimitTime(new Date(t).getTime()),this.draw(),this._emitTime()},e.setRange=function(t,e){this._range[0]=new Date(t).getTime(),this._range[1]=new Date(e).getTime(),this._datetime=this._getLimitTime(this._datetime),this.draw(),this._emitTime()},e.setStyle=function(t){this._options.style=t,this._canvas.style.backgroundColor=this._options.style.backgroundColor},e._getLimitTime=function(t){return t=this._checkEnableTime(t)?t:t>this._range[1]?this._range[1]:this._range[0]},e.updateSize=function(){var t=this._canvas.offsetWidth;this._canvas.style.height="60px",this._canvas.width=t,this._canvas.height=60,this.draw()},e.dispose=function(){this._obsEle(),clearTimeout(this._timerEmit),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("mousemove",this._onMouesmove)},t}()}();
