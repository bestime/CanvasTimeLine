/**  
 * CanvasTimeLineTheme02.iife.min.js
 * @QQ 1174295440
 * @update 2023-03-28 16:26:44
 */
var CanvasTimeLineTheme02=function(){"use strict";function E(t){return null===(e=t)||e===undefined?"":String(t);var e}var z=Object.prototype.toString;function s(t){switch(z.call(t).slice(8,-1)){case"Array":for(var e=[],n=0;n<t.length;n++)e.push(s(t[n]));break;case"Object":for(var r in e={},t)e[r]=s(t[r]);break;case"Function":function i(){t.apply(this,arguments)}for(var o in t.prototype)i.prototype[o]=t.prototype[o];e=i;break;default:e=t}return e}function F(t,e,n,r){return(t=E(t)).length>(e>>=0)?t:(e-=t.length,n.length<e&&(n+=function(t,e){var n="";if((t=E(t)).length*e<1<<28)for(;1==(1&e)&&(n+=t),0!=(e>>>=1);)t+=t;return n}(n,e/n.length)),-1===r?n.slice(0,e)+t:t+n.slice(0,e))}function n(t,e,n){return F(t,e,n,-1)}document.getElementsByTagName("head")[0];var r,i,R=0,o=!1,a={};var W={add:function(t,e){return i="HI-"+ ++R,a[i]={start:+new Date,current:0,handler:t,interval:e},o||(clearInterval(r),o=!0,r=setInterval(function(){for(var t in a){var e=a[t];e.current=+new Date,e.current-e.start>=e.interval&&(e.start=e.current,a[t].handler())}},17)),i},remove:function(t){delete a[t],function(t){var e,n=!0;for(e in t)if(e!==undefined){n=!1;break}return n}(a)&&(o=!1,clearInterval(r),r=undefined)}},t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,u=t||e||Function("return this")(),e=u.Symbol,c=Object.prototype,N=c.hasOwnProperty,I=c.toString,h=e?e.toStringTag:undefined;var H=Object.prototype.toString;var $="[object Null]",U="[object Undefined]",q=e?e.toStringTag:undefined;function p(t){if(null==t)return t===undefined?U:$;if(q&&q in Object(t)){var e=t,n=N.call(e,h),r=e[h];try{e[h]=undefined;var i=!0}catch(s){}var o=I.call(e);return i&&(n?e[h]=r:delete e[h]),o}return H.call(t)}function _(t){return null!=t&&"object"==typeof t}var Y="[object Symbol]";var d=Array.isArray,G=/\s/;var V=/^\s+/;function J(t){return t&&t.slice(0,function(t){for(var e=t.length;e--&&G.test(t.charAt(e)););return e}(t)+1).replace(V,"")}function y(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var K=NaN,Q=/^[-+]0x[0-9a-f]+$/i,Z=/^0b[01]+$/i,tt=/^0o[0-7]+$/i,et=parseInt;function nt(t){if("number"==typeof t)return t;if("symbol"==typeof(e=t)||_(e)&&p(e)==Y)return K;if("string"!=typeof(t=y(t)?y(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=J(t);var e=Z.test(t);return e||tt.test(t)?et(t.slice(2),e?2:8):Q.test(t)?K:+t}function rt(t){return t}var it="[object AsyncFunction]",ot="[object Function]",st="[object GeneratorFunction]",at="[object Proxy]";function v(t){if(y(t))return(t=p(t))==ot||t==st||t==it||t==at}var c=u["__core-js_shared__"],ut=(e=/[^.]+$/.exec(c&&c.keys&&c.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"";var ct=Function.prototype.toString;var ht=/^\[object .+?Constructor\]$/,c=Function.prototype,e=Object.prototype,c=c.toString,e=e.hasOwnProperty,lt=RegExp("^"+c.call(e).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ft(t){var e;return y(t)&&(e=t,!(ut&&ut in e))&&(v(t)?lt:ht).test(function(t){if(null!=t){try{return ct.call(t)}catch(e){}try{return t+""}catch(e){}}return""}(t))}function l(t,e){e=e;e=null==(t=t)?undefined:t[e];return ft(e)?e:undefined}var pt=Object.create;function f(){}var _t=function(t){if(!y(t))return{};if(pt)return pt(t);f.prototype=t;t=new f;return f.prototype=undefined,t};var dt=Date.now;var m=function(){try{var t=l(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();vt=m?function(t,e){return m(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:rt,b=g=0;var vt,g,b,e=function(){var t=dt(),e=16-(t-b);if(b=t,0<e){if(800<=++g)return arguments[0]}else g=0;return vt.apply(undefined,arguments)},mt=9007199254740991,yt=/^(?:0|[1-9]\d*)$/;function gt(t,e){var n=typeof t;return(e=null==e?mt:e)&&("number"==n||"symbol"!=n&&yt.test(t))&&-1<t&&t%1==0&&t<e}function x(t,e,n){"__proto__"==e&&m?m(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function T(t,e){return t===e||t!=t&&e!=e}var bt=Object.prototype.hasOwnProperty;function xt(t,e,n,r){for(var i,o,s=!n,a=(n=n||{},-1),u=e.length;++a<u;){var c=e[a],h=r?r(n[c],t[c],c,n,t):undefined;h===undefined&&(h=t[c]),s?x(n,c,h):(h=h,o=void 0,o=(i=n)[c=c],bt.call(i,c)&&T(o,h)&&(h!==undefined||c in i)||x(i,c,h))}return n}var Tt=Math.max;function jt(u,c,h){return c=Tt(c===undefined?u.length-1:c,0),function(){for(var t=arguments,e=-1,n=Tt(t.length-c,0),r=Array(n);++e<n;)r[e]=t[c+e];for(var e=-1,i=Array(c+1);++e<c;)i[e]=t[e];i[c]=h(r);var o=u,s=this,a=i;switch(a.length){case 0:return o.call(s);case 1:return o.call(s,a[0]);case 2:return o.call(s,a[0],a[1]);case 3:return o.call(s,a[0],a[1],a[2])}return o.apply(s,a)}}var wt=9007199254740991;function Pt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=wt}function j(t){return null!=t&&Pt(t.length)&&!v(t)}var Ot=Object.prototype;function St(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Mt(t){return _(t)&&"[object Arguments]"==p(t)}var c=Object.prototype,At=c.hasOwnProperty,Ct=c.propertyIsEnumerable,w=Mt(function(){return arguments}())?Mt:function(t){return _(t)&&At.call(t,"callee")&&!Ct.call(t,"callee")};var c="object"==typeof exports&&exports&&!exports.nodeType&&exports,P=c&&"object"==typeof module&&module&&!module.nodeType&&module,P=P&&P.exports===c?u.Buffer:undefined,Xt=(P?P.isBuffer:undefined)||function(){return!1},O={};O["[object Float32Array]"]=O["[object Float64Array]"]=O["[object Int8Array]"]=O["[object Int16Array]"]=O["[object Int32Array]"]=O["[object Uint8Array]"]=O["[object Uint8ClampedArray]"]=O["[object Uint16Array]"]=O["[object Uint32Array]"]=!0,O["[object Arguments]"]=O["[object Array]"]=O["[object ArrayBuffer]"]=O["[object Boolean]"]=O["[object DataView]"]=O["[object Date]"]=O["[object Error]"]=O["[object Function]"]=O["[object Map]"]=O["[object Number]"]=O["[object Object]"]=O["[object RegExp]"]=O["[object Set]"]=O["[object String]"]=O["[object WeakMap]"]=!1;var kt,c="object"==typeof exports&&exports&&!exports.nodeType&&exports,S=c&&"object"==typeof module&&module&&!module.nodeType&&module,M=S&&S.exports===c&&t.process,P=function(){try{var t=S&&S.require&&S.require("util").types;return t?t:M&&M.binding&&M.binding("util")}catch(e){}}(),c=P&&P.isTypedArray,Bt=c?(kt=c,function(t){return kt(t)}):function(t){return _(t)&&Pt(t.length)&&!!O[p(t)]},Dt=Object.prototype.hasOwnProperty;function Lt(t,e){var n,r=d(t),i=!r&&w(t),o=!r&&!i&&Xt(t),s=!r&&!i&&!o&&Bt(t),a=r||i||o||s,u=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=u.length;for(n in t)!e&&!Dt.call(t,n)||a&&("length"==n||o&&("offset"==n||"parent"==n)||s&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||gt(n,c))||u.push(n);return u}var Et=Object.prototype.hasOwnProperty;function zt(t){if(!y(t)){var e=t,n=[];if(null!=e)for(var r in Object(e))n.push(r);return n}var i,o=St(t),s=[];for(i in t)("constructor"!=i||!o&&Et.call(t,i))&&s.push(i);return s}function Ft(t){return j(t)?Lt(t,!0):zt(t)}var A=l(Object,"create");var Rt=Object.prototype.hasOwnProperty;var Wt=Object.prototype.hasOwnProperty;function C(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function X(t,e){for(var n=t.length;n--;)if(T(t[n][0],e))return n;return-1}C.prototype.clear=function(){this.__data__=A?A(null):{},this.size=0},C.prototype["delete"]=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},C.prototype.get=function(t){var e,n=this.__data__;return A?"__lodash_hash_undefined__"===(e=n[t])?undefined:e:Rt.call(n,t)?n[t]:undefined},C.prototype.has=function(t){var e=this.__data__;return A?e[t]!==undefined:Wt.call(e,t)},C.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=A&&e===undefined?"__lodash_hash_undefined__":e,this};var Nt=Array.prototype.splice;function k(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}k.prototype.clear=function(){this.__data__=[],this.size=0},k.prototype["delete"]=function(t){var e=this.__data__;return!((t=X(e,t))<0||(t==e.length-1?e.pop():Nt.call(e,t,1),--this.size,0))},k.prototype.get=function(t){var e=this.__data__;return(t=X(e,t))<0?undefined:e[t][1]},k.prototype.has=function(t){return-1<X(this.__data__,t)},k.prototype.set=function(t,e){var n=this.__data__,r=X(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var It=l(u,"Map");function B(t,e){var n,r,t=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?t["string"==typeof e?"string":"hash"]:t.map}function D(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}D.prototype.clear=function(){this.size=0,this.__data__={hash:new C,map:new(It||k),string:new C}},D.prototype["delete"]=function(t){return t=B(this,t)["delete"](t),this.size-=t?1:0,t},D.prototype.get=function(t){return B(this,t).get(t)},D.prototype.has=function(t){return B(this,t).has(t)},D.prototype.set=function(t,e){var n=B(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Ht=Object.getPrototypeOf,$t=Object;var Ht,$t,Ut=function(t){return Ht($t(t))},qt="[object Object]",t=Function.prototype,P=Object.prototype,Yt=t.toString,Gt=P.hasOwnProperty,Vt=Yt.call(Object);function L(t){t=this.__data__=new k(t);this.size=t.size}L.prototype.clear=function(){this.__data__=new k,this.size=0},L.prototype["delete"]=function(t){var e=this.__data__,t=e["delete"](t);return this.size=e.size,t},L.prototype.get=function(t){return this.__data__.get(t)},L.prototype.has=function(t){return this.__data__.has(t)},L.prototype.set=function(t,e){var n=this.__data__;if(n instanceof k){var r=n.__data__;if(!It||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new D(r)}return n.set(t,e),this.size=n.size,this};var c="object"==typeof exports&&exports&&!exports.nodeType&&exports,t=c&&"object"==typeof module&&module&&!module.nodeType&&module,P=t&&t.exports===c?u.Buffer:undefined,Jt=P?P.allocUnsafe:undefined;var Kt=u.Uint8Array;function Qt(t,e){var n,e=e?(e=t.buffer,n=new e.constructor(e.byteLength),new Kt(n).set(new Kt(e)),n):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}var Zt,te=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),s=o.length;s--;){var a=o[Zt?s:++r];if(!1===e(i[a],a,i))break}return t},ee=function(){return u.Date.now()},ne=Math.max,re=Math.min;function ie(r,n,t){var i,o,s,a,u,c,h=0,l=!1,f=!1,e=!0;if("function"!=typeof r)throw new TypeError("Expected a function");function p(t){var e=i,n=o;return i=o=undefined,h=t,a=r.apply(n,e)}function _(t){var e=t-c;return c===undefined||n<=e||e<0||f&&s<=t-h}function d(){var t,e=ee();if(_(e))return v(e);u=setTimeout(d,(t=n-((e=e)-c),f?re(t,s-(e-h)):t))}function v(t){return u=undefined,e&&i?p(t):(i=o=undefined,a)}function m(){var t=ee(),e=_(t);if(i=arguments,o=this,c=t,e){if(u===undefined)return h=t=c,u=setTimeout(d,n),l?p(t):a;if(f)return clearTimeout(u),u=setTimeout(d,n),p(c)}return u===undefined&&(u=setTimeout(d,n)),a}return n=nt(n)||0,y(t)&&(l=!!t.leading,f="maxWait"in t,s=f?ne(nt(t.maxWait)||0,n):s,e="trailing"in t?!!t.trailing:e),m.cancel=function(){u!==undefined&&clearTimeout(u),h=0,i=c=o=u=undefined},m.flush=function(){return u===undefined?a:v(ee())},m}function oe(t,e,n){(n===undefined||T(t[e],n))&&(n!==undefined||e in t)||x(t,e,n)}function se(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function ae(t,e,n,r,i,o,s){var a,u,c,h=se(t,n),l=se(e,n),f=s.get(l);f||((e=(f=o?o(h,l,n+"",t,e,s):undefined)===undefined)&&(u=!(c=d(l))&&Xt(l),a=!c&&!u&&Bt(l),f=l,c||u||a?f=d(h)?h:_(c=h)&&j(c)?function(t,e){var n=-1,r=t.length;for(e=e||Array(r);++n<r;)e[n]=t[n];return e}(h):u?(c=l,(u=!(e=!1))?c.slice():(u=c.length,u=Jt?Jt(u):new c.constructor(u),c.copy(u),u)):a?Qt(l,!(e=!1)):[]:function(t){if(_(t)&&p(t)==qt)return null===(t=Ut(t))||"function"==typeof(t=Gt.call(t,"constructor")&&t.constructor)&&t instanceof t&&Yt.call(t)==Vt}(l)||w(l)?w(f=h)?f=xt(h,Ft(h)):y(h)&&!v(h)||(f="function"!=typeof(c=l).constructor||St(c)?{}:_t(Ut(c))):e=!1),e&&(s.set(l,f),i(f,l,r,o,s),s["delete"](l))),oe(t,n,f)}function ue(r,i,o,s,a){r!==i&&te(i,function(t,e){var n;a=a||new L,y(t)?ae(r,i,e,o,ue,s,a):((n=s?s(se(r,e),t,e+"",r,i,a):undefined)===undefined&&(n=t),oe(r,e,n))},Ft)}ce=function(t,e,n,r){ue(t,e,n,r)};var ce,he,le=e(jt(t=function(t,e){var n=-1,r=e.length,i=1<r?e[r-1]:undefined,o=2<r?e[2]:undefined,i=3<ce.length&&"function"==typeof i?(r--,i):undefined;for(o&&function(t,e,n){var r;if(y(n))return("number"==(r=typeof e)?j(n)&&gt(e,n.length):"string"==r&&e in n)&&T(n[e],t)}(e[0],e[1],o)&&(i=r<3?undefined:i,r=1),t=Object(t);++n<r;){var s=e[n];s&&ce(t,s,n,i)}return t},he,rt),t+"");function fe(t){var e=null==t?0:t.length;return e?t[e-1]:undefined}function pe(t){return t&&t.length?t[0]:undefined}function _e(t){t=new Date(t);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),milliSecond:t.getMilliseconds()}}return function(){function t(t,e){var n,r,i,o,s,a,u,c,h=this,l=(this._times=[],this._options=void 0,this._canvas=void 0,this._ctx=void 0,this._element=void 0,this._pressX=0,this._currentWidth=0,this._originTimes=[],this._offsetX={pre:0,current:0},this._playing=!1,this._currentPopper=void 0,this._previewPopper=void 0,this._playBtn=void 0,this._canvasRoom=void 0,this._bodyPopper=void 0,this.currentTime="",this._locking=!1,this._timerAuto=void 0,this._timerObv=void 0,this._mousein=!1,this._obvHandler=void 0,t.classList.add("canvas-timeLine-theme02"),this._onMouesmove=this._onMouesmove.bind(this),this._onMouseup=this._onMouseup.bind(this),document.createElement("canvas"));function f(){var t,e;document.body.contains(n)?(t=!1,null!=i&&i.includes("position")&&(e=n.getBoundingClientRect(),a[0]=e.left,a[2]=a[0]!==a[1],u[0]=e.top,u[2]=u[0]!==u[1]),o[0]=n.offsetWidth,o[2]=o[0]!==o[1],s[0]=n.offsetHeight,s[2]=s[0]!==s[1],o[2]&&(o[1]=o[0],null!=i)&&i.includes("width")&&(t=!0),s[2]&&(s[1]=s[0],null!=i)&&i.includes("height")&&(t=!0),(u[2]||a[2])&&(u[1]=u[0],a[1]=a[0],null!=i)&&i.includes("position")&&(t=!0),i&&0!==i.length||(o[2]||s[2]||u[2]||a[2])&&(t=!0),t&&r(n)):p()}function p(){W.remove(c),o=undefined,s=undefined}this._currentPopper=document.createElement("div"),this._currentPopper.className="current",this._previewPopper=document.createElement("div"),this._previewPopper.className="preview",this._playBtn=document.createElement("div"),this._playBtn.innerText="播放",this._playBtn.className="play",this._canvasRoom=document.createElement("div"),this._canvasRoom.className="canvas-room",this._element=t,this._bodyPopper=document.createElement("div"),this._bodyPopper.className="body",this._canvas=l,this._ctx=l.getContext("2d"),this._options=le({scale:"day",scaleSpace:70,autoPlayInterval:1e3,style:{font:"12px Microsoft YaHei",progressBarBackgroundColor:"#35323f",progressBarActiveColor:"#4492d5",scaleLineColor:"#fff",scaleFontColor:"#fff"}},e),this._initDrag(),t.appendChild(this._bodyPopper),this._bodyPopper.appendChild(this._playBtn),this._canvasRoom.appendChild(l),this._bodyPopper.appendChild(this._canvasRoom),this._bodyPopper.appendChild(this._currentPopper),this._bodyPopper.appendChild(this._previewPopper),this._obvHandler=(n=this._element,r=function(){h._canvas.style.width=h._times.length*h._options.scaleSpace+"px",clearTimeout(h._timerObv),h._timerObv=setTimeout(function(){h._scrollToCurrent()},30)},i=["width","position"],u=[0,0,!(a=[0,0,!(s=[0,0,!(o=[0,0,!(e=100)])])])],c=W.add(f,e=e||500),f(),p),this._playBtn.onclick=function(){if(clearTimeout(h._timerAuto),h._playing=!h._playing,!h._playing)return h._playBtn.innerHTML="播放",h._bodyPopper.classList.remove("playing"),h;h._playBtn.innerHTML="暂停",h._bodyPopper.classList.add("playing"),h._checkAutoPlay()}}var e=t.prototype;return e._checkAutoPlay=function(){var e=this;clearTimeout(this._timerAuto),this._playing&&!this._mousein&&0<this._options.autoPlayInterval&&(this._timerAuto=setTimeout(function(){var t=e._findNextTime();e.setDateTime(t,!1)},this._options.autoPlayInterval))},e._getPrevTime=function(){for(var t="",e=this._times.length-1;0<=e;e--)for(var n=this._times[e].data.length-1;0<=n;n--)this._times[e].data[n]===this.currentTime&&(t=0===n?0===e?this.currentTime:fe(this._times[e-1].data):this._times[e].data[n-1]);return t},e._getNextTime=function(){for(var t="",e=0;e<this._times.length;e++)for(var n=0;n<this._times[e].data.length;n++)this._times[e].data[n]===this.currentTime&&(t=n===this._times[e].data.length-1?e===this._times.length-1?this.currentTime:this._times[e+1].data[0]:this._times[e].data[n+1]);return t},e._findNextTime=function(){for(var t="",e=0;e<this._times.length;e++)for(var n=0;n<this._times[e].data.length;n++)this._times[e].data[n]===this.currentTime&&(t=n===this._times[e].data.length-1?(e===this._times.length-1?this._times[0]:this._times[e+1]).data[0]:this._times[e].data[n+1]);return t},e._onMouseup=function(){this._offsetX.pre=this._offsetX.current,document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("mousemove",this._onMouesmove)},e._onMouesmove=function(t){var e,t=t.clientX-this._pressX;0<t?this._offsetX.current=Math.min(t+this._offsetX.pre,0):t<0?(e=Math.max(t+this._offsetX.pre,-(this._times.length*this._options.scaleSpace-this._canvasRoom.offsetWidth)),this._offsetX.current=Math.min(e,0)):this._offsetX.current=t+this._offsetX.pre,this.draw()},e._initDrag=function(){var n=this;this._canvas.onmousedown=function(t){n._mousein=!0,n._pressX=t.clientX,document.removeEventListener("mouseup",n._onMouseup),document.removeEventListener("mousemove",n._onMouesmove),document.addEventListener("mouseup",n._onMouseup),document.addEventListener("mousemove",n._onMouesmove)},this._canvas.onmousemove=function(t){n._mousein=!0;var e,t=n.getMouseDatetime(t.clientX,n._currentWidth);t?(e=n._getCurrentLeft(t)+n._offsetX.current,n._previewPopper.innerText=n._options.labelFormat?n._options.labelFormat(t):t,n._previewPopper.style.display="block",t=n._canvas.getBoundingClientRect(),n._previewPopper.style.left=t.left+e-n._previewPopper.offsetWidth/2+"px",n._previewPopper.style.top=t.top-n._previewPopper.offsetHeight-8+"px"):n._previewPopper.style.display="none"},this._canvas.onmouseout=this._canvas.onmouseleave=ie(function(){n._previewPopper.style.display="none",n._mousein=!1,n._checkAutoPlay()},200),this._canvas.ondblclick=function(t){t=n.getMouseDatetime(t.clientX,n._currentWidth);t&&n.setDateTime(t,!0)}},e._getCurrentLeft=function(t){for(var e=0,n=!1,r=0;r<this._times.length;r++){for(var i=0;i<this._times[r].data.length;i++)if(this._times[r].data[i]===t){var o=this._times[r].data.length;r===this._times.length-1&&o--,e=r*this._options.scaleSpace+this._options.scaleSpace/o*i,n=!0;break}if(n)break}return e},e.setData=function(t){return(t=s(t)).sort(function(t,e){return new Date(t).getTime()-new Date(e).getTime()}),this._originTimes=t,this._times=function(t,e){for(var n={},r=0;r<t.length;r++){var i=t[r],o=_e(new Date(i).getTime()),s="";"day"===e?s=o.year+"-"+o.month+"-"+o.day:"hour"===e&&(s=o.year+"-"+o.month+"-"+o.day+" "+o.hour),n[s]||(n[s]={value:i,data:[]}),n[s].data.push(i)}var a,u=[];for(a in n)u.push(n[a]);return u.sort(function(t,e){return new Date(t.value).getTime()-new Date(e.value).getTime()}),u}(t,this._options.scale),t.length&&(this._canvas.style.width=this._times.length*this._options.scaleSpace+"px",this.setDateTime(pe(t),!1)),this},e.draw=function(){var t=this._times.length*this._options.scaleSpace,e=this._canvasRoom.offsetWidth;this._canvasRoom.offsetWidth>t&&(e=t,this._offsetX.current=0,this._offsetX.pre=0),this._canvas.width=e,this._canvas.height=26,this._canvas.style.width=e+"px",this._canvas.style.height="26px",this._canvasRoom.style.height="26px",this._ctx.fillStyle="transparent",this._ctx.fillRect(0,0,e,26),this._drawProgress(),this._drawScales()},e._formatScale=function(t){var e;return this._options.scaleFormat?this._options.scaleFormat(t):(e=_e(new Date(t).getTime()),"day"===this._options.scale?n(e.month,2,"0")+"月"+n(e.day,2,"0")+"日":"hour"===this._options.scale?n(e.day,2,"0")+"日"+n(e.hour,2,"0")+"时":t)},e.getMouseDatetime=function(t,e){var n,r=this._canvas.getBoundingClientRect(),t=Math.round(t-r.left)-this._offsetX.current,r=Math.floor(t/this._options.scaleSpace),i=this._times[r];if(i)return n=0,t<e?n=Math.floor(t%this._options.scaleSpace/(this._options.scaleSpace/i.data.length)):(n=Math.ceil(t%this._options.scaleSpace/(this._options.scaleSpace/i.data.length)))>i.data.length-1&&(n=0,i=this._times[++r]),null!=(e=i)&&null!=(t=e.data)&&t[n]||(r=this._times.length-1,n=(i=this._times[r]).data.length-1),i.data[n]},e._drawProgress=function(){var t=this._getCurrentLeft(this.currentTime),e=this._times.length*this._options.scaleSpace,t=(this._currentWidth=t)+this._offsetX.current,e=(this._ctx.beginPath(),this._ctx.lineWidth=6,this._ctx.lineCap="round",this._ctx.strokeStyle=this._options.style.progressBarBackgroundColor,this._ctx.moveTo(this._offsetX.current+3,3),this._ctx.lineTo(this._offsetX.current+e-3,3),this._ctx.stroke(),this._ctx.closePath(),this._offsetX.current+3),n=t;0<=n&&(n-=3,this._ctx.beginPath(),this._ctx.lineWidth=6,this._ctx.strokeStyle=this._options.style.progressBarActiveColor,this._ctx.moveTo(e,3),this._ctx.lineTo(n,3),this._ctx.stroke(),this._ctx.closePath()),this.currentTime&&t<=this._canvasRoom.offsetWidth&&0<=t?(this._currentPopper.style.display="block",this._currentPopper.innerText=this._options.labelFormat?this._options.labelFormat(this.currentTime):this.currentTime,e=this._canvas.getBoundingClientRect(),this._currentPopper.style.left=e.left+t-this._currentPopper.offsetWidth/2+"px",this._currentPopper.style.top=e.top-this._currentPopper.offsetHeight-8+"px"):this._currentPopper.style.display="none"},e._drawScales=function(){this._ctx.lineCap="butt";for(var t=1;t<this._times.length;t++){this._ctx.beginPath(),this._ctx.lineWidth=1,this._ctx.strokeStyle=this._options.style.scaleLineColor;var e=this._options.scaleSpace*t-.5+this._offsetX.current,n=(this._ctx.moveTo(e,6),this._ctx.lineTo(e,12),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.fillStyle=this._options.style.scaleFontColor,this._ctx.font=this._options.style.font,this._formatScale(this._times[t].value)),r=this._ctx.measureText(n).width;this._ctx.fillText(n,e-Math.floor(r/2),24),this._ctx.closePath()}},e._scrollToCurrent=function(){var t=this._getCurrentLeft(this.currentTime)-3;this._pressX=0,this._offsetX.pre=0,this._offsetX.current=this._offsetX.pre,this._onMouesmove({clientX:-t}),this._offsetX.pre=this._offsetX.current},e.setDateTime=function(e,t){var n=this;if(!this.currentTime||this.currentTime!==e)return this._locking?console.error('时间设置失败： "'+e+'"。上一个切换未完成！'):this._originTimes.some(function(t){return t===e})?(this.currentTime=e,t?this.draw():this._scrollToCurrent(),null!=(t=this._options)&&t.onChange&&(this._locking=!0,t={value:this.currentTime,start:pe(this._originTimes),end:fe(this._originTimes),prev:this._getPrevTime(),next:this._getNextTime()},this._options.onChange(t,function(){n._locking=!1,n._checkAutoPlay()}))):console.error('时间设置失败： "'+e+'" 不在列表中'),this},e.dispose=function(){this._obvHandler(),clearTimeout(this._timerObv),clearTimeout(this._timerAuto),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("mousemove",this._onMouesmove)},t}()}();
